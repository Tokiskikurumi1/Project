<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Báo cáo Doanh thu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="./css/base.css" />
    <link rel="stylesheet" href="./css/header_sidebar.css" />
    <link rel="stylesheet" href="./css/admin-common.css" />
  </head>
  <body>
    <div class="overlay" id="overlay"></div>

    <!-- Sidebar placeholder -->
    <div id="sidebar-placeholder"></div>

    <div id="right-content">
      <!-- Header placeholder -->
      <div id="header-placeholder"></div>

      <main class="admin-main">
        <section class="report-card">
          <h2><i class="fas fa-chart-line"></i> Báo cáo doanh thu</h2>

          <!-- Bộ lọc -->
          <div
            class="filter-bar"
            style="
              display: flex;
              gap: 16px;
              flex-wrap: wrap;
              margin-bottom: 24px;
            "
          >
            <select id="reportPeriod">
              <option value="today">Hôm nay</option>
              <option value="week">Tuần này</option>
              <option value="month" selected>Tháng này</option>
              <option value="custom">Tùy chỉnh</option>
            </select>
            <button class="btn-primary" onclick="generateReport()">
              <i class="fas fa-sync"></i> Xem báo cáo
            </button>
          </div>

          <!-- Thống kê tổng quan -->
          <div
            class="stats-grid"
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
              gap: 20px;
              margin-bottom: 32px;
            "
          >
            <div
              class="stat-card"
              style="
                background: #fff8f5;
                padding: 20px;
                border-radius: 12px;
                text-align: center;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
              "
            >
              <h4 style="color: #8d6e63; margin-bottom: 8px">Doanh thu</h4>
              <p
                id="totalRevenue"
                style="font-size: 2rem; font-weight: 700; color: #6b4e31"
              >
                45.680.000đ
              </p>
            </div>
            <div
              class="stat-card"
              style="
                background: #fff8f5;
                padding: 20px;
                border-radius: 12px;
                text-align: center;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
              "
            >
              <h4 style="color: #8d6e63; margin-bottom: 8px">Số hóa đơn</h4>
              <p
                id="orderCount"
                style="font-size: 2rem; font-weight: 700; color: #6b4e31"
              >
                128
              </p>
            </div>
            <div
              class="stat-card"
              style="
                background: #fff8f5;
                padding: 20px;
                border-radius: 12px;
                text-align: center;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
              "
            >
              <h4 style="color: #8d6e63; margin-bottom: 8px">
                Trung bình / đơn
              </h4>
              <p
                id="avgOrder"
                style="font-size: 2rem; font-weight: 700; color: #6b4e31"
              >
                356.875đ
              </p>
            </div>
          </div>

          <!-- Biểu đồ top sản phẩm bán chạy (cột) -->
          <div
            class="chart-container"
            style="
              background: white;
              padding: 24px;
              border-radius: 12px;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            "
          >
            <h3 style="margin-bottom: 16px; color: #6b4e31">
              Top 10 sản phẩm bán chạy
            </h3>
            <canvas id="topProductsChart" height="300"></canvas>
          </div>

          <!-- Top món bán chạy dạng text (dự phòng) -->
          <div id="topItemList" style="margin-top: 24px">
            <h3>Top món bán chạy:</h3>
            <ul id="topItems" style="list-style: none; padding: 0"></ul>
          </div>
        </section>
      </main>
    </div>

    <script src="./js/header_siderbar.js"></script>
    <script>
      // Dữ liệu cứng để demo giao diện (sau này lấy từ orders)
      const demoTopProducts = [
        { name: "Cà phê sữa đá", quantity: 320, revenue: 4800000 },
        { name: "Trà sữa trân châu", quantity: 285, revenue: 4275000 },
        { name: "Matcha latte", quantity: 210, revenue: 3150000 },
        { name: "Cappuccino nóng", quantity: 180, revenue: 2700000 },
        { name: "Sinh tố dâu", quantity: 145, revenue: 2175000 },
        { name: "Espresso", quantity: 120, revenue: 1800000 },
        { name: "Trà đào cam sả", quantity: 110, revenue: 1650000 },
        { name: "Latte nóng", quantity: 95, revenue: 1425000 },
        { name: "Sinh tố xoài", quantity: 80, revenue: 1200000 },
        { name: "Americano", quantity: 65, revenue: 975000 },
      ];

      // Render biểu đồ cột
      function renderTopProductsChart() {
        const ctx = document
          .getElementById("topProductsChart")
          .getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: demoTopProducts.map((item) => item.name),
            datasets: [
              {
                label: "Số lượng bán",
                data: demoTopProducts.map((item) => item.quantity),
                backgroundColor: "#8d6e63",
                borderColor: "#6b4e31",
                borderWidth: 1,
              },
              {
                label: "Doanh thu (triệu VND)",
                data: demoTopProducts.map((item) => item.revenue / 1000000),
                backgroundColor: "#d4af37",
                borderColor: "#b8860b",
                borderWidth: 1,
                yAxisID: "y1",
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: "Số lượng" },
              },
              y1: {
                position: "right",
                beginAtZero: true,
                title: { display: true, text: "Doanh thu (triệu)" },
                grid: { drawOnChartArea: false },
              },
            },
            plugins: {
              legend: { position: "top" },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    let label = context.dataset.label || "";
                    if (label) label += ": ";
                    if (context.parsed.y !== null) {
                      label += context.parsed.y;
                      if (context.dataset.label.includes("Doanh thu"))
                        label += " triệu";
                      else label += " ly";
                    }
                    return label;
                  },
                },
              },
            },
          },
        });

        // Render list text dự phòng
        const topList = document.getElementById("topItems");
        topList.innerHTML = demoTopProducts
          .map(
            (item) => `
        <li style="margin: 8px 0; font-size: 1.1rem;">
          <strong>${item.name}</strong>: ${item.quantity} ly - ${item.revenue.toLocaleString("vi-VN")}đ
        </li>
      `,
          )
          .join("");
      }

      // Giả lập generate report (dùng dữ liệu cứng)
      function generateReport() {
        const period = document.getElementById("reportPeriod").value;
        console.log("Xem báo cáo theo:", period);

        // Giả lập cập nhật số liệu
        document.getElementById("totalRevenue").textContent = "45.680.000đ";
        document.getElementById("orderCount").textContent = "128";
        document.getElementById("avgOrder").textContent = "356.875đ";

        // Render biểu đồ
        renderTopProductsChart();
      }

      // Load ban đầu
      document.addEventListener("DOMContentLoaded", () => {
        generateReport(); // Demo ngay khi load
      });
    </script>
  </body>
</html>
